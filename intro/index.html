<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=0.7,user-scalable=no" />
		<title>SHOT PLANE</title>
		<link rel="stylesheet" href="css/style.css">
	</head>
	<body>

		<canvas id="map"></canvas>
		<script type="text/javascript">
		  var mapCanvas = document.getElementById("map");
		  var ctx = mapCanvas.getContext("2d");
		  var restartLi = document.getElementById("restart");
		  mapCanvas.width = document.documentElement.clientWidth;
		  mapCanvas.height = document.documentElement.clientHeight;
		  var picsnames = [ "bullet.png", "enemy.png", "herofly.png"];
		  var picCount = 0;
		  for (var i = 0; i < picsnames.length; i++) {
		  	var img = new Image();
		  	img.src = "img/" + picsnames[i];
		  	img.onload = function() {
		  		picCount++;
		  		}
		  }
		  var heroImg = new Image();
		  heroImg.src = "img/herofly.png";
		  var bulletImg = new Image();
		  bulletImg.src = "img/bullet.png";
		  var hero = {
		  	x: mapCanvas.width / 2 - 33,
		  	y: mapCanvas.height - 82 - 100,
		  	w: 66,
		  	h: 82,
		  	i: 0,
		  	flagI: 0,
		  	flagShot: 0,
		  	armType: 0,
		  	boom: false,
		  	draw: function() {
		  		this.flagI++;
		  		if (this.flagI === 10) {
		  			if (this.boom) {
		  				this.i++;
		  				if (this.i === 5) {
		  					gameOver();
		  				}
		  			}
		  			else {
		  				this.i = (this.i++) % 2;
		  			}
		  			this.flagI = 0;
		  		}
		  		ctx.drawImage(heroImg, this.i * this.w, 0, this.w, this.h, this.x, this.y, this.w, this.h);
		  	},
		  	shot: function() {
		  		if (!this.boom) {
		  			this.flagShot++;
		  		}
		  		if (this.flagShot === 5) {
		  				var bullet = new Bullet(this.x + this.w / 2 - 2, this.y - 14, 6, 14, bulletImg, 1);
		  			this.flagShot = 0;
		  		}
		  	},
		  }
		  mapCanvas.onmousedown = function(event) {
		  	var x = event.offsetX;
		  	var y = event.offsetY;
		  	if (x >= hero.x && x <= hero.x + hero.w && y >= hero.y && y <= hero.y + hero.h) {
		  		mapCanvas.onmousemove = function(event) {
		  			hero.x = event.offsetX - hero.w / 2;
		  			hero.y = event.offsetY - hero.h / 2;
		  		}
		  	}
		  }
		  mapCanvas.onmouseup = function() {
		  	mapCanvas.onmousemove = null;
		  }
		  mapCanvas.ontouchend = function() {
		  	mapCanvas.ontouchmove = null;
		  }

		  function Bullet(x, y, w, h, img, hurt) {
		  	this.x = x;
		  	this.y = y;
		  	this.w = w;
		  	this.h = h;
		  	this.img = img;
		  	this.hurt = hurt;
		  }
		  Bullet.prototype.draw = function() {
		  	ctx.drawImage(this.img, this.x, this.y, this.w, this.h);
		  }
		  Bullet.prototype.move = function() {
		  	this.y -= 15;
		  }

		  function Enemy(x, y, w, h, img, speed, hp, maxI) {
		  	this.x = x;
		  	this.y = y;
		  	this.w = w;
		  	this.h = h;
		  	this.img = img;
		  	this.speed = speed;
		  	this.hp = hp;
		  	this.boom = false;
		  	this.i = 0;
		  	this.maxI = maxI;
		  	this.isDie = false;
		  	this.flagI = 0;
		  }
		  Enemy.prototype.draw = function() {
		  	if (this.boom) {
		  		this.flagI++;
		  		if (this.flagI === 5) {
		  			this.i++;
		  			if (this.i === this.maxI) {
		  				this.isDie = true;
		  			}
		  			this.flagI = 0;
		  		}
		  	}
		  	ctx.drawImage(this.img, this.i * this.w, 0, this.w, this.h, this.x, this.y, this.w, this.h);
		  }
		  Enemy.prototype.move = function() {
		  	this.y += this.speed;
		  }

		  function random(x, y) {
		  	return parseInt(Math.random() * (y - x + 1) + x);
		  }
		  var enemyImg = new Image();
		  enemyImg.src = "img/enemy1.png";
		  var enemies = [];

		  function randomEnemy() {
		  	var num = random(1, 1000);
		  	if (num <= 50) {
				enemies.push(enemy);
		  	}
		  	for (var i = 0; i < enemies.length; i++) {
		  		if (enemies[i].y >= mapCanvas.height || enemies[i].isDie) {
		  			enemies.splice(i, 1);
		  			i--;
		  		}
		  		else {
		  			enemies[i].move();
		  			enemies[i].draw();
		  		}
		  	}
		  }
		  var timeout = null;
		</script>
	</body>
</html>