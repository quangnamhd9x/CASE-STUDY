<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bảo Vệ Trái Đất</title>
    <script src="js/plane.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body onload="StartGame()">
<table>
    <tr>
        <td>
            <canvas id="myCanvas" width="900" height="585">
            </canvas>
        </td>
        <div><label id="score"></label></div>
    </tr>
    <script>
        let score = 0;
        let canvas = document.getElementById("myCanvas");
        let ctx = canvas.getContext("2d");
        let enemy = [];
        let bullet = [];
        let plane;
        let countbullet = 0;
        let count = 0;
        let nhacNen;
        let soundGetScore;
        let speed = 4;
        let remainPoint = 0;
        let ping1;
        let ping2;
        let ping3;
        window.addEventListener("mousemove", moveMouse)
        let Plane = function (x, y) {
            this.x = x;
            this.y = y;
            this.image = new Image();
            this.image.src = "img/plane.png";
            this.creatPlane = function () {
                ctx.drawImage(this.image, this.x, this.y, 70, 70);
            }
            this.checkDiem = function (point) {
                if ((point.x > this.x && point.x + 30 < this.x + 200)
                    && (point.y + 100 > this.y && point.y < this.y + 150)) {
                    point.y += 800;
                    score += 1;
                    remainPoint += 1;
                    soundGetScore.play();
                }
            }
        };
        let Enemy = function (x, y) {
            this.x = x;
            this.y = y;
            this.move = speed;
            this.image = new Image();
            this.image.src = "img/enemy.png";
            this.creatEnemy = function () {
                this.y += this.move;
                ctx.drawImage(this.image, this.x, this.y, 70, 70);
            }
        };

        function creatNewEnemy() {
            count++;
            let randomX = Math.floor(Math.random() * (1000)) + 50;
            enemy[count] = new Enemy(randomX, -100);
        }

        let Bullet = function (x, y) {
            this.x = x;
            this.y = y;
            this.move = speed + 10;
            this.image = new Image();
            this.image.src = "img/bullet.png";
            this.creatBullet = function () {
                this.y += this.move;
                ctx.drawImage(this.image, this.x, this.y, 50, 50);
            }
        };

        function creatNewBullet() {
            countbullet++;
            let randomX = Math.floor(Math.random() * (900)) + 50;
            bullet[countbullet] = new Bullet(randomX, -100);
        }

        function StartGame() {
            let randomX = Math.floor(Math.random() * (700)) + 1;
            enemy[count] = new Enemy(randomX, -100);
            bullet[countbullet] = new Bullet(randomX, -100);
            plane = new Plane(300, 500);
            soundAll();
            ping1 = setInterval(drawALL, 30);
            ping2 = setInterval(creatNewEnemy, 1000);
            ping3 = setInterval(creatNewBullet, 500);
        }

        function soundAll() {
            nhacNen = new Audio("sound/nhacnen.mp3");
            soundGetScore = new Audio("sound/ghidiem.mp3");
        }

        function hardPlus() {
            if (remainPoint > 20) {
                speed += 3;
                remainPoint = 0;
            }
        }

        function drawALL() {
            ctx.clearRect(0, 0, 900, 585);
            for (let i = 0; i < enemy.length; i++) {
                enemy[i].creatEnemy();
                plane.checkDiem(enemy[i]);
            }
            for (let i = 0; i < bullet.length; i++) {
                bullet[i].creatBullet();
                plane.checkDiem(bullet[i]);
            }
            hardPlus(score);
            plane.creatPlane();
            document.getElementById('score').innerHTML = "Tiêu diệt: " + score;
            nhacNen.play();
        }

        function moveMouse(event) {
            let canvas_x = event.pageX - 9;
            plane.x = canvas_x - 200;
        }

    </script>
</table>
</body>
</html>